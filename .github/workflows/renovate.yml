name: 🔄 Renovate Bot

on:
  schedule:
    # Run every day at 06:00 UTC (07:00 CET / 08:00 CEST)
    - cron: '0 6 * * *'
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'
        required: false
        default: 'info'
        type: choice
        options:
          - info
          - debug
          - warn
          - error

env:
  LOG_LEVEL: ${{ inputs.logLevel || 'info' }}

jobs:
  renovate:
    runs-on: ubuntu-latest
    name: 🔧 Renovate Dependencies
    
    steps:
      - name: 📥 Checkout repository
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: 🤖 Run Renovate
        uses: renovatebot/github-action@v40.1.12
        with:
          configurationFile: renovate.json
          token: ${{ secrets.GITHUB_TOKEN }}
        env:
          LOG_LEVEL: ${{ env.LOG_LEVEL }}
          RENOVATE_REPOSITORIES: ${{ github.repository }}
          RENOVATE_AUTODISCOVER: false
          
      - name: 📊 Summary
        if: always()
        run: |
          echo "## 🔄 Renovate Bot Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Parameter | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|-----------|-------|" >> $GITHUB_STEP_SUMMARY
          echo "| Repository | ${{ github.repository }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Trigger | ${{ github.event_name }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Log Level | ${{ env.LOG_LEVEL }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Timestamp | $(date -u) |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### 📋 Configured Update Targets:" >> $GITHUB_STEP_SUMMARY
          echo "- 🐳 Docker images in Helm values" >> $GITHUB_STEP_SUMMARY
          echo "- 📦 Helm chart dependencies" >> $GITHUB_STEP_SUMMARY
          echo "- 🔭 OpenTelemetry components" >> $GITHUB_STEP_SUMMARY
          echo "- 📊 Observability stack (Prometheus, Grafana, Jaeger, Tempo)" >> $GITHUB_STEP_SUMMARY
          echo "- ⚙️ GitHub Actions" >> $GITHUB_STEP_SUMMARY
